<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlowMate: High-Contrast Luxury UI</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load React and Babel (Crucial for running JSX in the browser) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Custom Fonts and Base Styles -->
    <style>
        body {
            background-color: #FFFFFF;
            color: #0A0A0A;
            font-family: 'Inter', sans-serif; /* Set default font */
        }
        /* Import Playfair Display for headings */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&display=swap');
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- **CRITICAL:** The script block must have type="text/babel" to run JSX -->
    <script type="text/babel">
    
    // --- Design Tokens and Core Helpers ---
    const DESIGN = {
      PRIMARY_NOIR: "#0A0A0A", LUXURY_ACCENT: "#D4A373", HIGHLIGHT_PLUM: "#5E2A5E", GLOW_FUCHSIA: "#C2185B", 
      SURFACE_CARD: "#FFFFFF", BACKGROUND: "#FFFFFF", MUTED_TEXT: "#4A4A4A", BORDER: "#E6E0EB",
      SUCCESS: "#52C57B", ERROR: "#E75468", ROUNDING_CARD: "rounded-[18px]", ROUNDING_BUTTON: "rounded-[28px]",
      PRIMARY_CTA_GRADIENT: "bg-gradient-to-r from-[#5E2A5E] via-[#C2185B] to-[#D4A373]",
    };
    
    const LS_KEYS = {
      PROFILE: "gm_profile", REVIEWS: "gm_reviews", VOTES: "gm_votes", ROUTINE: "gm_routine",
      SAVED: "gm_saved", COMMENTS: "gm_comments", FOLLOWING: "gm_following",
    };

    const price = (p) => <span className={`text-[${DESIGN.LUXURY_ACCENT}] font-semibold`}>‚Çπ{p.toLocaleString("en-IN")}</span>;
    const getBrandLogo = (brand) => `https://placehold.co/32x32/ffffff/${DESIGN.HIGHLIGHT_PLUM.substring(1)}?text=${brand.substring(0,1)}`;

    function saveLS(key, val) {
      if (typeof window === "undefined") return;
      window.localStorage.setItem(key, JSON.stringify(val));
    }

    function loadLS(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        return raw ? JSON.parse(raw) : fallback;
      } catch(e) {
        return fallback;
      }
    }

    const getProduct = (id) => PRODUCTS.find(p => p.id === id);

    // --- Product Data (Truncated for readability, full data in application logic) ---
    const CATEGORIES = ["cleanser","moisturizer","sunscreen","serum","foundation","lipstick","kajal","blush","primer"];
    const PRODUCTS = [
      {id:"p_min_spf", brand:"Minimalist", name:"SPF 50 PA++++ Sunscreen Gel", category:"sunscreen", priceMin:399, priceMax:599, tags:["gel","no white cast"], ingredients:["UV filters","niacinamide"], for:["oily","combination","normal"], availability:true},
      {id:"p_dk_cica", brand:"Dot & Key", name:"Cica Niacinamide Sunscreen SPF 50 PA++++", category:"sunscreen", priceMin:595, priceMax:795, tags:["calming","oil control","fragrance-free"], ingredients:["cica","niacinamide"], for:["oily","combination","sensitive"], availability:true},
      {id:"p_lor_uvd", brand:"L‚ÄôOr√©al Paris", name:"UV Defender Serum Protector SPF 50", category:"sunscreen", priceMin:699, priceMax:999, tags:["serum-like","makeup friendly"], ingredients:["UV filters"], for:["all"], availability:true},
      {id:"p_tdc_spf", brand:"The Derma Co", name:"Gel Sunscreen SPF 50", category:"sunscreen", priceMin:499, priceMax:699, tags:["niacinamide","vitamin E"], ingredients:["niacinamide","vitamin E"], for:["oily","combination"], availability:true},
      {id:"p_paula_spf", brand:"Paula‚Äôs Choice", name:"Super-Light Daily Wrinkle Defense SPF 30", category:"sunscreen", priceMin:2850, priceMax:3250, tags:["tinted","matte","non-comedogenic"], ingredients:["zinc oxide"], for:["oily","combination"], availability:false},
      {id:"p_maybelline_found", brand:"Maybelline", name:"Superstay 24H Foundation", category:"foundation", priceMin:549, priceMax:799, tags:["transfer-proof","matte"], ingredients:[], for:["oily","combination"], availability:true, shades:["110C","128W","220N","310W","330W","340N"]},
      {id:"p_loreal_infallible", brand:"L‚ÄôOr√©al Paris", name:"Infallible 24H Fresh Wear Foundation", category:"foundation", priceMin:799, priceMax:1299, tags:["longwear","natural"], ingredients:[], for:["all"], availability:true, shades:["120C","140N","200W","330N","365W"]},
      {id:"p_mac_studio", brand:"MAC", name:"Studio Fix Fluid SPF 15", category:"foundation", priceMin:3200, priceMax:3900, tags:["premium","wide shades"], ingredients:[], for:["all"], availability:true, shades:["NC20","NC30","NC42","NW35","NW45"]},
      {id:"p_min_niac", brand:"Minimalist", name:"Niacinamide 5% + HA", category:"serum", priceMin:399, priceMax:699, tags:["oil control","pores"], ingredients:["niacinamide","HA"], for:["oily","combination","acne"], availability:true},
    ];

    const DEMO_CREATORS = [
      { id: "c_1", name: "Shreya Jain", handle: "shreyajain26", nykaaId: "NYK-SHREYA-01", niche: "Glam & everyday makeup", followers: "500k+", tags: ["Glam", "Indian Skin", "Acne Safe"], miniRoutine: [PRODUCTS[5], PRODUCTS[8]], favoritePick: PRODUCTS[8] },
    ];

    const INITIAL_REVIEWS = [
        { id: 'r_001', productId: 'p_min_spf', rating: 4, text: "Great texture, absorbs fast. I feel like it sometimes pills under my makeup, but for the price, it's a solid community staple. Oily skin, no white cast!", skinType: 'oily', anon: true, createdAt: new Date(Date.now() - 86400000).toISOString()},
        { id: 'r_002', productId: 'p_lor_uvd', rating: 5, text: "Worth the splurge! My skin stays hydrated all day, perfect for my dry skin. Holy grail product. Love it!", skinType: 'dry', anon: false, createdAt: new Date(Date.now() - 86400000 * 5).toISOString()},
    ];
    
    // --- Remaining Logic Helpers ---
    function wilsonLowerBound(avg, n, z=1.96){ return n===0 ? 0 : (avg/5); }
    function decayFactor(weeksAgo){ return Math.pow(0.85, weeksAgo); }
    function weeksBetween(d1, d2){ return Math.floor(Math.abs(d1 - d2) / (1000*60*60*24*7)); }

    function seedIfEmpty() {
      if (!localStorage.getItem(LS_KEYS.REVIEWS)) saveLS(LS_KEYS.REVIEWS, INITIAL_REVIEWS);
      if (!localStorage.getItem(LS_KEYS.VOTES)) {
        const defaultVotes = {};
        INITIAL_REVIEWS.forEach(r => defaultVotes[r.id] = 1);
        saveLS(LS_KEYS.VOTES, defaultVotes);
      }
      if (!localStorage.getItem(LS_KEYS.ROUTINE)) saveLS(LS_KEYS.ROUTINE, { am: [], pm: [], makeup: [] });
      if (!localStorage.getItem(LS_KEYS.COMMENTS)) saveLS(LS_KEYS.COMMENTS, {});
      if (!localStorage.getItem(LS_KEYS.FOLLOWING)) saveLS(LS_KEYS.FOLLOWING, ["NYK-SHREYA-01"]);
    }
    
    function checkRoutineConflicts(currentRoutine) {
        const warnings = {am: [], pm: [], makeup: []};
        // Simple mock conflict logic: no sunscreen in PM
        if (currentRoutine.pm.some(i => getProduct(i.id)?.category === 'sunscreen')) {
          warnings.pm.push('Sunscreen is unnecessary at night. Move it to your AM routine.');
        }
        return warnings;
    }

    function communityScore(productId) {
      const reviews = loadLS(LS_KEYS.REVIEWS, []).filter(r=>r.productId===productId);
      const n = reviews.length;
      const today = new Date();
      const weighted = reviews.map(r=>{
        const w = decayFactor(weeksBetween(today, new Date(r.createdAt)));
        return r.rating * w;
      });
      const wAvg = weighted.length ? weighted.reduce((a,b)=>a+b,0)/weighted.length : 0;
      return wilsonLowerBound(wAvg, n || 1);
    }
    
    function fitScore(profile, product, category) {
      let score = 0;
      const concerns = new Set(profile?.concerns || []);
      const ing = (product.ingredients || []).map(x=>x.toLowerCase());
      const has = (k)=> ing.some(i=>i.includes(k));

      if (concerns.has("acne") && (has("niacinamide") || has("salicylic"))) score += 0.5;
      if (product.tags?.includes("fragrance-free") && profile.sensitive) score += 0.3;
      return Math.min(1, score);
    }

    function rankProducts({profile, category}){
      let list = PRODUCTS.filter(p=>!category || p.category===category);
      list = list.map(p=>{
        const FS = fitScore(profile, p, category);
        const CS = communityScore(p.id);
        const R = 0.6*FS + 0.4*CS;
        return {...p, score: R, subscores:{FS,CS}};
      })
      .sort((a,b)=>b.score - a.score);
      return list.slice(0,5);
    }
    
    const handleAIChat = ({userText, profile, getProduct, setCategory, allReviews, allCreators, allRoutine}) => {
        const text = userText.toLowerCase().trim();
        const categories = CATEGORIES.join('|');
        const ingredients = ['niacinamide', 'salicylic acid', 'vitamin c', 'aha', 'bha', 'retinol'];
        
        // 1. Routine Building & Safety Check
        if (/(build|suggest|create|routine)/.test(text)) {
            const slots = ['am', 'pm', 'makeup'].filter(s => text.includes(s));
            const slot = slots.length ? slots[0] : 'am';
            const ranked = rankProducts({profile, category: 'cleanser'}).slice(0, 1)
                .concat(rankProducts({profile, category: 'moisturizer'}).slice(0, 1));
            
            let routineSteps = ranked.filter(p => p.category !== 'sunscreen' || slot === 'am')
                .map(p => `‚Ä¢ ${p.name} (${p.category}) - ${p.tags[0]}`);

            return { role: 'assistant', text: `I've built a quick **${slot.toUpperCase()} routine** based on your needs. Check out the ${slot.toUpperCase()} section in "Routine"! \n\n**Steps suggested:**\n${routineSteps.join('\n')}` };
        }
        
        // 2. Ingredient Explanation
        else if (new RegExp(`(${ingredients.join('|')})`).test(text) && /(what is|what does|explain)/.test(text)) {
            const match = text.match(new RegExp(`(${ingredients.join('|')})`));
            const ing = match ? match[1] : null;

            if (ing === 'niacinamide') {
                return { role: 'assistant', text: `**Niacinamide (Vitamin B3)** helps minimize enlarged pores, tighten skin, and improve barrier function. Should I find a niacinamide serum for you?` };
            }
        }
        
        // 3. General Recommendation Flow (Default)
        else if (new RegExp(`(${categories.join('|')})`).test(text) || /(recommend|pick|best)/.test(text)) {
            const catMatch = text.match(new RegExp(`(${categories.join('|')})`));
            const cat = catMatch ? catMatch[1] : profile.category || 'sunscreen';
            
            const ranked = rankProducts({profile, category: cat});
            
            return { role: 'assistant', text: `Based on your ${profile.skinType} skin and interest in **${cat}**, here are your top picks! Check the cards in the section below.` };
        } 
        
        // 4. Fallback
        else {
            return { role: 'assistant', text: `I'm still learning! You can ask me to: **Recommend a cleanser**, **Explain Retinol**, or **Build a PM routine**!` };
        }
    }


    /********************\
    |* UI Helper Pieces *|
    /********************/

    function IconPill({label, icon, active, onClick, color}){
      return (
        <button type="button" onClick={onClick} className={`flex items-center gap-1.5 px-3 py-1.5 ${DESIGN.ROUNDING_CARD} border ${DESIGN.BORDER} text-sm mr-2 mb-2 transition-colors duration-200 
          ${active ? `bg-[${DESIGN.HIGHLIGHT_PLUM}] text-white` : `bg-white text-[${DESIGN.MUTED_TEXT}] hover:bg-gray-50`}`}>
          <span className={`text-lg ${active ? 'text-white' : color}`}>{icon}</span>
          {label}
        </button>
      );
    }

    function Section({title, children, right}){
      return (
        <div className="mb-8">
          <div className="flex items-center justify-between mb-4">
            {/* H2 Typography: 26px, Playfair, Medium */}
            <h3 className={`text-[26px] font-medium text-[${DESIGN.PRIMARY_NOIR}] playfair-text`}>{title}</h3>
            {right}
          </div>
          {/* Luxury Card Styling + Shadow + Rounding */}
          <div className={`bg-[${DESIGN.SURFACE_CARD}] ${DESIGN.ROUNDING_CARD} shadow-lg p-6 border ${DESIGN.BORDER}`}>{children}</div>
        </div>
      );
    }

    function Pill({label, active, onClick}){
      return (
        <button type="button" onClick={onClick} className={`px-3 py-1 text-[12px] ${DESIGN.ROUNDING_BUTTON} border ${DESIGN.BORDER} mr-2 mb-2 transition-colors duration-200 
          ${active ? `bg-[${DESIGN.HIGHLIGHT_PLUM}] text-white font-semibold` : `bg-white text-[${DESIGN.MUTED_TEXT}] hover:bg-gray-50`}`}>
          {label}
        </button>
      );
    }

    function RatingStars({ rating }){
        const filledStars = Math.round(rating);
        const starArray = Array(5).fill(0).map((_, i) => i < filledStars);
        return (
            <div className="flex items-center gap-0.5 text-yellow-500">
                {starArray.map((filled, i) => (
                    <span key={i} className={`text-[16px] ${filled ? 'opacity-100' : 'text-gray-300 opacity-100'}`}>‚òÖ</span>
                ))}
            </div>
        );
    }

    const ProductCardV2 = ({ p, onAddToRoutine, onStartReview }) => {
        const scoreText = (p.score * 100).toFixed(0);
        const brandLogo = getBrandLogo(p.brand);

        const ButtonCTA = ({ label, slot, onClickHandler }) => (
            <button
                type="button"
                onClick={onClickHandler}
                className={`px-3 py-2 text-white font-bold text-[14px] ${DESIGN.ROUNDING_BUTTON} ${DESIGN.PRIMARY_CTA_GRADIENT} hover:opacity-90 transition-opacity whitespace-nowrap`}
            >
                {label}
            </button>
        );

        return (
            <div className={`bg-white ${DESIGN.ROUNDING_CARD} p-5 flex flex-col gap-3 shadow-md border ${DESIGN.BORDER}`}>
                {/* Header Row: Brand, Name, Category, Price, Stars (Contained and Aligned) */}
                <div className="flex flex-col gap-2">
                    <div className="flex items-center justify-between">
                        <div className="flex items-start gap-3">
                            {/* Brand Logo & Name */}
                            <img src={brandLogo} alt={`${p.brand} logo`} className="w-8 h-8 rounded-full border border-gray-200" />
                            <div>
                                 {/* Product Name (H3 Style) */}
                                <div className={`font-medium text-[20px] text-[${DESIGN.PRIMARY_NOIR}] playfair-text`}>{p.name}</div>
                                <div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>{p.brand} | {p.category}</div>
                            </div>
                        </div>
                        {/* Price (Rose Gold Accent) */}
                        <div className={`font-bold text-[16px]`}>{price(p.priceMin)}</div>
                    </div>

                    {/* Rating and Match Score (Aligned below product info) */}
                    <div className="flex items-center justify-between pt-2">
                        <div className="flex items-center gap-2">
                            <RatingStars rating={p.score * 5} />
                            <span className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>({scoreText} community endorsement)</span>
                        </div>
                        <div className={`text-[14px] font-semibold text-[${DESIGN.HIGHLIGHT_PLUM}]`}>Match: {scoreText}%</div>
                    </div>
                </div>

                {/* Tags/Reason */}
                <div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}] border-t ${DESIGN.BORDER} pt-3`}>
                    <span className="font-semibold text-[${DESIGN.PRIMARY_NOIR}]">Why it fits:</span> {p.tags.slice(0, 2).join(", ")}.
                </div>

                {/* Action Buttons (Unified Style) */}
                <div className="flex flex-wrap gap-2 pt-2">
                    <ButtonCTA label="Add to AM" onClickHandler={() => onAddToRoutine(p, 'am')} />
                    <ButtonCTA label="Add to PM" onClickHandler={() => onAddToRoutine(p, 'pm')} />
                    <ButtonCTA label="Add to Makeup" onClickHandler={() => onAddToRoutine(p, 'makeup')} />
                    <ButtonCTA label="Start Review" onClickHandler={() => onStartReview(p)} />
                </div>
            </div>
        );
    };

    function ReviewCardV2({ r, p, votes, rComments, onToggleComment, submitComment, commentDrafts, setCommentDrafts, openCommentsState }){
        const [expanded, setExpanded] = useState(false);
        const hasLongText = r.text.length > 100;
        const currentDraft = commentDrafts[r.id] || "";
        const brandLogo = getBrandLogo(p?.brand || "G");

        // Community Card Styling - White background
        return (
            <div className={`bg-white ${DESIGN.ROUNDING_CARD} p-5 mb-4 shadow-md border ${DESIGN.BORDER}`}>
                <div className="flex items-start justify-between mb-2">
                    <div className="flex items-center gap-3">
                        <img src={brandLogo} alt={p?.brand || "Logo"} className="w-8 h-8 rounded-full border border-gray-200" />
                        <div>
                            <div className={`font-medium text-[20px] text-[${DESIGN.PRIMARY_NOIR}] playfair-text`}>{p?.name || "Product Name"}</div>
                            <div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>{p?.brand} | {r.skinType}</div>
                        </div>
                    </div>
                </div>

                {/* Rating Stars (Aligned and Contained) */}
                <div className="flex items-center justify-between border-b border-gray-100 pb-2 mb-3">
                    <div className="flex items-center gap-2">
                        <RatingStars rating={r.rating} />
                        <span className={`text-[14px] text-[${DESIGN.MUTED_TEXT}] font-semibold`}>({r.rating}.0/5)</span>
                    </div>
                    <div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>
                        {r.anon ? "Community Member" : "GlowMate User"}
                    </div>
                </div>

                <p className={`text-[16px] text-[${DESIGN.PRIMARY_NOIR}] ${!expanded && hasLongText ? 'line-clamp-3' : ''}`}>
                    {r.text}
                </p>
                {hasLongText && (
                    <button onClick={() => setExpanded(!expanded)} className={`text-[14px] text-[${DESIGN.LUXURY_ACCENT}] hover:text-gray-900 mt-1 transition-colors`}>
                        {expanded ? "Show less" : "Read more..."}
                    </button>
                )}

                <div className="mt-4 flex flex-wrap items-center gap-4 text-sm border-t border-gray-100 pt-3">
                    <button type="button" className={`text-2xl text-[${DESIGN.LUXURY_ACCENT}] transition-transform hover:scale-[1.2]`} onClick={()=>toggleVote(r.id)}>
                        {votes[r.id]?"‚ù§Ô∏è":"ü§ç"}
                    </button>
                    <button type="button" className={`text-2xl text-[${DESIGN.LUXURY_ACCENT}] transition-transform hover:scale-[1.2]`} onClick={()=>onToggleComment(r.id)}>
                        üí¨
                    </button>
                    <span className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>
                        {rComments.length} Comments
                    </span>
                </div>

                {openCommentsState[r.id] && (
                    <div className="mt-4 border-t border-gray-100 pt-4">
                        <ul className="text-[14px] space-y-2 mb-3 max-h-48 overflow-y-auto">
                            {rComments.map(c=> (
                                <li key={c.id} className={`bg-gray-50 rounded-[16px] px-3 py-2 border ${DESIGN.BORDER}`}>
                                    <div className={`text-[${DESIGN.PRIMARY_NOIR}]`}>{c.text}</div>
                                </li>
                            ))}
                        </ul>
                        <div className="flex gap-2">
                            <input
                                className={`flex-1 border ${DESIGN.BORDER} rounded-xl px-3 py-2 text-[16px] bg-white text-[${DESIGN.PRIMARY_NOIR}] focus:border-[${DESIGN.HIGHLIGHT_PLUM}]`}
                                placeholder="Add a comment..."
                                value={currentDraft}
                                onChange={(e)=>setCommentDrafts(d=>({...d, [r.id]: e.target.value}))}
                            />
                            <button type="button" className={`px-4 py-2 bg-[${DESIGN.HIGHLIGHT_PLUM}] text-white text-[16px] ${DESIGN.ROUNDING_BUTTON} hover:bg-[${DESIGN.GLOW_FUCHSIA}] transition-colors`} onClick={()=>submitComment(r.id)}>Post</button>
                        </div>
                    </div>
                )}
            </div>
        );
    }

    const ProfileSummary = ({ profile }) => (
        <div className={`bg-gray-50 p-4 ${DESIGN.ROUNDING_CARD} mb-4 flex flex-wrap gap-x-4 gap-y-2 text-[16px] border ${DESIGN.BORDER} shadow-sm`}>
            <span className={`font-semibold text-[${DESIGN.HIGHLIGHT_PLUM}]`}>My Profile:</span>
            <span className={`capitalize text-[${DESIGN.PRIMARY_NOIR}] font-medium`}>
                ‚ú® {profile.skinType}
            </span>
            <span className={`text-[${DESIGN.PRIMARY_NOIR}]`}>
                üí∏ {profile.budgetBucket}
            </span>
            {profile.concerns.slice(0, 3).map(c => (
                <span key={c} className={`text-white font-medium bg-[${DESIGN.HIGHLIGHT_PLUM}] px-2 ${DESIGN.ROUNDING_BUTTON} text-[14px] self-center capitalize`}>
                    {c}
                </span>
            ))}
            <button onClick={() => alert("Edit controls are in the 'Personalization & Filters' section below!")} className={`text-[14px] text-[${DESIGN.LUXURY_ACCENT}] hover:text-gray-900 ml-auto`}>Edit</button>
        </div>
    );

    const CreatorCardV2 = ({ creator, isFollowing, onToggleFollow }) => {
        const unlocked = isFollowing;
        const brandLogo = getBrandLogo(creator.name);
        return (
          <div className={`bg-white ${DESIGN.ROUNDING_CARD} p-5 flex flex-col gap-3 shadow-md border ${DESIGN.BORDER}`}>
            <div className="flex items-center gap-4">
              <img src={brandLogo} alt={`${creator.name} logo`} className="w-8 h-8 rounded-full object-cover border border-gray-200"/>
              <div className="flex-1">
                <div className={`font-medium text-[20px] text-[${DESIGN.PRIMARY_NOIR}] playfair-text`}>{creator.name}</div>
                <div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>@{creator.handle}</div>
              </div>
              <button
                type="button"
                onClick={onToggleFollow}
                className={`px-6 h-12 text-white font-bold text-[16px] ${DESIGN.ROUNDING_BUTTON} transition-all ${unlocked ? `border border-[${DESIGN.HIGHLIGHT_PLUM}]/80 bg-white text-[${DESIGN.HIGHLIGHT_PLUM}] hover:bg-gray-100` : DESIGN.PRIMARY_CTA_GRADIENT + ' hover:opacity-90'}`}
              >
                {unlocked ? "Following" : "Follow +"}
              </button>
            </div>
            
            <div className={`text-[16px] text-[${DESIGN.MUTED_TEXT}]`}>
              Niche: {creator.niche}
            </div>
            <div className="flex flex-wrap gap-1">
              {creator.tags.map(tag => (
                  <span key={tag} className={`text-[12px] bg-[${DESIGN.HIGHLIGHT_PLUM}] text-white px-2 py-0.5 ${DESIGN.ROUNDING_BUTTON}`}>{tag}</span>
              ))}
              <span className={`text-[12px] bg-[${DESIGN.GLOW_FUCHSIA}] text-white px-2 py-0.5 ${DESIGN.ROUNDING_BUTTON} font-medium`}>Top Nykaa Creator</span>
            </div>
            {unlocked && creator.miniRoutine && (
                 <div className="mt-2 border-t border-gray-100 pt-3">
                     <h4 className={`text-[16px] font-semibold text-[${DESIGN.PRIMARY_NOIR}]`}>Unlocked Mini-Routine:</h4>
                     <ul className={`list-disc ml-5 text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>
                         {creator.miniRoutine.map(p => <li key={p.id}>{p.brand} {p.name}</li>)}
                     </ul>
                 </div>
             )}
          </div>
        );
    }

    const FollowedCreatorsSection = ({ followedCreators, getProduct }) => (
        <div className={`mt-8 ${followedCreators.length === 0 ? 'hidden' : ''}`}>
            <Section title="Your Followed Creators" right={<span className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>Unlocked Content</span>}>
                <div className="grid md:grid-cols-1 gap-4">
                    {followedCreators.map(creator => (
                        <div key={creator.id} className={`p-4 bg-gray-50 ${DESIGN.ROUNDING_CARD} border ${DESIGN.BORDER}`}>
                            <h4 className={`text-[16px] font-semibold text-[${DESIGN.HIGHLIGHT_PLUM}]`}>{creator.name}'s Top Pick:</h4>
                            <p className={`text-[14px] text-[${DESIGN.PRIMARY_NOIR}]`}>{creator.favoritePick.brand} {creator.favoritePick.name}</p>
                        </div>
                    ))}
                </div>
            </Section>
        </div>
    );


    export default function GlowMate(){
      seedIfEmpty();
      const [tab, setTab] = useState("discover");
      const [profile, setProfile] = useState(()=>loadLS(LS_KEYS.PROFILE, {
        skinType: "oily", concerns: ["acne","oiliness"], budgetBucket: "300-700", sensitive: false,
      }));
      const [chat, setChat] = useState([{
        role:"assistant", text:"Your personal beauty concierge awaits. What‚Äôs your skin type, your top 2‚Äì3 concerns, and your budget per item? üå∏",
      }]);
      const [input, setInput] = useState(""); 
      const [isTyping, setIsTyping] = useState(false);
      const [routine, setRoutine] = useState(()=>loadLS(LS_KEYS.ROUTINE, {am:[], pm:[], makeup:[]}));
      const [showShareModal, setShowShareModal] = useState(false);

      const [reviews, setReviews] = useState(()=>loadLS(LS_KEYS.REVIEWS, INITIAL_REVIEWS));
      const [votes, setVotes] = useState(()=>loadLS(LS_KEYS.VOTES, {}));
      const [comments, setComments] = useState(()=>loadLS(LS_KEYS.COMMENTS, {}));
      const [openComments, setOpenComments] = useState({});
      const [commentDrafts, setCommentDrafts] = useState({});
      const [newReview, setNewReview] = useState({productId: PRODUCTS[0].id, rating:5, text:"", skinType: profile.skinType, concerns: profile.concerns, anon:true});
      const [following, setFollowing] = useState(()=>loadLS(LS_KEYS.FOLLOWING, []));
      const [creatorIdInput, setCreatorIdInput] = useState("");
      const [lastSearchedId, setLastSearchedId] = useState("");
      const [guideState, setGuideState] = useState({});
      const [communityFilter, setCommunityFilter] = useState({productId: null, category: null});

      useEffect(()=>{ saveLS(LS_KEYS.PROFILE, profile); }, [profile]);
      useEffect(()=>{ saveLS(LS_KEYS.REVIEWS, reviews); }, [reviews]);
      useEffect(()=>{ saveLS(LS_KEYS.VOTES, votes); }, [votes]);
      useEffect(()=>{ saveLS(LS_KEYS.ROUTINE, routine); }, [routine]);
      useEffect(()=>{ saveLS(LS_KEYS.COMMENTS, comments); }, [comments]);
      useEffect(()=>{ saveLS(LS_KEYS.FOLLOWING, following); }, [following]);
      
      const [category, setCategory] = useState("sunscreen");
      
      const ranked = useMemo(()=>rankProducts({profile, category}), [profile, category, reviews]);
      const followedCreators = useMemo(() => DEMO_CREATORS.filter(c=> following.includes(c.nykaaId)), [following]);
      
      const weeklyTop = useMemo(()=>{
        const now = new Date();
        const byCat = {};
        CATEGORIES.forEach(c=> byCat[c]=[]);
        reviews.forEach(r=>{
          const ageDays = (now - new Date(r.createdAt))/(1000*60*60*24);
          const recent = ageDays <= 30 ? 1 : 0.5;
          const up = votes[r.id] || 0;
          const prod = getProduct(r.productId);
          if (!prod) return;
          const cat = prod.category;
          const entry = byCat[cat].find(e=>e.productId===r.productId) || (()=>{const e={productId:r.productId, score:0, count:0, sum:0}; byCat[cat].push(e); return e;})();
          entry.count += 1; entry.sum += r.rating; entry.score += 0.5*up + 0.3*1 + 0.2*r.rating/5;
          entry.score *= recent;
        });
        const top = {};
        Object.entries(byCat).forEach(([cat, arr])=>{
          const sorted = arr.sort((a,b)=>b.score-a.score).slice(0,5).map(e=>({
            product: getProduct(e.productId),
            avg: e.count? (e.sum/e.count).toFixed(1):"‚Äì",
            n: e.count,
          }));
          top[cat] = sorted;
        });
        return top;
      }, [reviews, votes]);
      
      const routineWarnings = useMemo(() => checkRoutineConflicts(routine), [routine]);


      const handleAIChatWrapper = async (userText) => {
        // Simulate AI response delay
        setIsTyping(true);
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        const reply = handleAIChat({
            userText,
            profile,
            getProduct,
            setCategory,
            allReviews: reviews,
            allCreators: DEMO_CREATORS,
            allRoutine: routine,
        });

        if (reply) {
            setChat(ch => [...ch, reply]);
            if (reply.text.includes("top picks") || reply.text.includes("routine")) {
                setTab('discover'); // Ensure users see the recommendation cards
            }
        }
        setIsTyping(false);
      }

      const handleChatSubmit = (e) => {
        e.preventDefault();
        if (!input.trim() || isTyping) return;
        const userTurn = {role:"user", text: input.trim()};
        
        // Update profile based on text before sending to AI handler
        const txt = userTurn.text.toLowerCase();
        const p = {...profile};
        if (/(dry|oily|combination|sensitive|normal)/.test(txt)) p.skinType = (txt.match(/dry|oily|combination|sensitive|normal/)||[])[0];
        setProfile(p); // Quick update

        setChat(ch=>[...ch, userTurn]);
        handleAIChatWrapper(userTurn.text);
        setInput("");
      }
      
      const handleNavigation = (newTab, filter = {}) => {
          setTab(newTab);
          if (newTab === 'community') {
              setCommunityFilter(filter);
          }
      }

      function submitReview(){
        const genId = 'r_' + Math.random().toString(36).slice(2);
        const r = {...newReview, id: genId, createdAt: new Date().toISOString() };
        setReviews(rs=>[r, ...rs]);
        setNewReview(n=>({...n, text:""}));
      }
      function toggleVote(reviewId){
        setVotes(v=>{ const next = v[reviewId] ? 0 : 1; return {...v, [reviewId]: next}; });
      }
      function toggleCommentOpen(reviewId){
        setOpenComments(o=>({...o, [reviewId]: !o[reviewId]}));
      }
      function submitComment(reviewId){
        const text = (commentDrafts[reviewId]||"").trim();
        if (!text) return;
        const genId = 'c_' + Math.random().toString(36).slice(2);
        setComments(c=>{
          const list = c[reviewId]? [...c[reviewId]] : [];
          list.push({id:genId, text, createdAt: new Date().toISOString()});
          return {...c, [reviewId]: list};
        });
        setCommentDrafts(d=>({...d, [reviewId]: ""}));
      }

      function handleAddToMakeupReview(p) {
          setNewReview({...newReview, productId: p.id, skinType: profile.skinType, concerns: profile.concerns});
          handleNavigation('community');
      }

      function addToRoutine(p, slot = 'am') {
        setRoutine(r => {
          const arr = [...r[slot]];
          if (!arr.find(x => x.id === p.id)) {
            arr.push({ id: p.id, name: `${p.brand} ${p.name}`, category: p.category });
          }
          return { ...r, [slot]: arr };
        });
      }
      function removeFromRoutine(slot, id){
        setRoutine(r=>({...r, [slot]: r[slot].filter(x=>x.id!==id)}));
      }

      const filteredReviews = useMemo(() => {
        let list = reviews;
        if (communityFilter.productId) {
            list = list.filter(r => r.productId === communityFilter.productId);
        } else if (communityFilter.category) {
            list = list.filter(r => getProduct(r.productId)?.category === communityFilter.category);
        }
        return list;
      }, [reviews, communityFilter]);

      const ROUTINE_SLOTS = [
          { key: 'am', label: 'AM Routine', icon: '‚òÄÔ∏è' },
          { key: 'pm', label: 'PM Routine', icon: 'üåô' },
          { key: 'makeup', label: 'Makeup Routine', icon: 'üíÑ' },
      ];

      const GUIDES_DATA = [
        { title: "SPF & PA: Your Daily Shield", icon: "‚òÄÔ∏è", content: ["SPF = UVB protection; PA rating indicates UVA protection (PA++++ is high).", "Apply ~2 fingers‚Äô worth for face/neck; reapply every 2‚Äì3 hours outdoors."], related: ["sunscreen", "vitamin C"] },
        { title: "AHA vs BHA: Exfoliation Explained", icon: "üß™", content: ["AHA (glycolic/lactic): surface exfoliation, glow & texture.", "BHA (salicylic): oil‚Äësoluble, gets into pores; great for acne/blackheads.", "Start low & slow: 2√ó/week PM; moisturize; sunscreen next day."], related: ["serum", "cleanser"] },
        { title: "Layering Basics: The Right Order", icon: "üíß", content: ["AM: cleanse ‚Üí treat (optional) ‚Üí moisturize ‚Üí sunscreen.", "PM: cleanse ‚Üí treat ‚Üí moisturize.", "Rule: Thinnest texture to thickest, ending with sun protection (AM) or occlusive (PM)."], related: ["routine"] },
        { title: "Conflict Checker: What Not to Mix", icon: "‚õî", content: ["Do NOT layer Retinol/AHAs/BHAs with Vitamin C at the same time (use Vit C in AM, acids in PM).", "Use Niacinamide to buffer strong actives, but avoid high concentrations (10%+) right after acids."], related: ["serum", "moisturizer"] },
      ];

      return (
        <div className={`min-h-screen bg-[${DESIGN.BACKGROUND}] text-[${DESIGN.PRIMARY_NOIR}]`}>
          <CustomStyles />

          <header className={`sticky top-0 z-10 bg-white shadow-lg border-b ${DESIGN.BORDER} max-w-6xl mx-auto px-4 pt-4 pb-3`}>
            <div className="flex flex-col md:flex-row items-center justify-between">
              <div className={`font-semibold text-[28px] mb-3 md:mb-0 text-[${DESIGN.HIGHLIGHT_PLUM}] playfair-text`}>GlowMate <span className={`text-[${DESIGN.GLOW_FUCHSIA}]`}>‚óè</span></div>
              <nav className="flex flex-wrap gap-1">
                {[
                  {k:"discover", label:"Home"},
                  {k:"community", label:"GlowCircle"},
                  {k:"creators", label:"Creators"},
                  {k:"guides", label:"Guides"},
                  {k:"routine", label:"Routine"},
                ].map(t=> (
                  <button key={t.k} type="button" onClick={()=>handleNavigation(t.k)} className={`px-4 py-2 ${DESIGN.ROUNDING_BUTTON} text-[16px] font-bold transition-colors 
                    ${tab===t.k ? `bg-[${DESIGN.HIGHLIGHT_PLUM}] text-white` : `hover:bg-gray-100 text-[${DESIGN.PRIMARY_NOIR}]`}`}>{t.label}</button>
                ))}
              </nav>
            </div>
          </header>

          <main className="max-w-6xl mx-auto px-4 pb-16">
            {tab==="discover" && (
              <div className="pt-6 grid md:grid-cols-3 gap-8">
                <div className="md:col-span-2">
                  <Section title="GlowMate Concierge" right={<div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>Your beauty concierge awaits. ‚ú®</div>}>
                    <div className={`h-72 overflow-y-auto border ${DESIGN.BORDER} ${DESIGN.ROUNDING_CARD} p-4 flex flex-col gap-2 bg-gray-50`}>
                      {chat.map((m, i)=> (
                        <div key={i} className={`max-w-[85%] ${m.role==='assistant'?"self-start":"self-end"}`}>
                          <div className={`${m.role==='assistant' ? `bg-white border ${DESIGN.BORDER} text-[${DESIGN.PRIMARY_NOIR}]` : `bg-[${DESIGN.ACCENT}] text-white`} rounded-[16px] p-3 text-[16px] shadow-sm`}>{m.text}</div>
                        </div>
                      ))}
                      {isTyping && (
                          <div className="self-start max-w-[85%]">
                              <div className={`bg-white border ${DESIGN.BORDER} rounded-[16px] p-3 text-[16px] shadow-sm`}>
                                <span className={`animate-pulse text-[${DESIGN.GLOW_FUCHSIA}]`}>...</span>
                              </div>
                          </div>
                      )}
                    </div>
                    
                    <form onSubmit={handleChatSubmit} className="mt-4 flex gap-3">
                      <input value={input} onChange={e=>setInput(e.target.value)} placeholder="Ask GlowMate anything..." className={`flex-1 px-4 py-3 rounded-xl border ${DESIGN.BORDER} text-[16px] bg-white text-[${DESIGN.PRIMARY_NOIR}]`}/>
                      <button type="submit" className={`px-6 h-12 text-white font-bold ${DESIGN.ROUNDING_BUTTON} ${DESIGN.PRIMARY_CTA_GRADIENT} hover:opacity-90 transition-opacity`}>Send</button>
                    </form>
                  </Section>

                  <Section title="Profile & Filters">
                    <ProfileSummary profile={profile} />
                    <div className="grid md:grid-cols-2 gap-6 text-[16px]">
                      <div>
                        <div className={`font-medium mb-1 text-[${DESIGN.PRIMARY_NOIR}]`}>Skin Type</div>
                        {['dry','oily','combination','sensitive','normal'].map(s=> (
                          <IconPill key={s} label={s} icon={s === 'dry' ? 'üíß' : s === 'oily' ? '‚ö™' : s === 'sensitive' ? 'üõ°Ô∏è' : 'üåø'} active={profile.skinType===s} onClick={()=>setProfile({...profile, skinType:s})}/>
                        ))}
                        <div className={`mt-4 font-medium mb-1 text-[${DESIGN.PRIMARY_NOIR}]`}>Top Concerns</div>
                        {['acne','oiliness','dullness','pigmentation','redness', 'fine lines'].map(c=> (
                          <Pill key={c} label={c} active={profile.concerns?.includes(c)} onClick={()=>{
                            const has = profile.concerns?.includes(c);
                            setProfile({...profile, concerns: has? profile.concerns.filter(x=>x!==c) : [...(profile.concerns||[]), c]})
                          }}/>
                        ))}
                      </div>
                      <div>
                        <div className={`font-medium mb-1 text-[${DESIGN.PRIMARY_NOIR}]`}>Budget per item</div>
                        {["<300","300-700","700-1200","1200-2500",">2500"].map(b=> (
                          <IconPill key={b} label={b} icon={'‚Çπ'} active={profile.budgetBucket===b} onClick={()=>setProfile({...profile, budgetBucket:b})}/>
                        ))}
                        <div className={`mt-4 font-medium mb-1 text-[${DESIGN.PRIMARY_NOIR}]`}>Practical Filters</div>
                        {['fragrance-free','non-comedogenic','beginner-friendly'].map(c=> (
                          <Pill key={c} label={c} active={profile.concerns?.includes(c)} onClick={()=>{}}/>
                        ))}
                        <div className={`mt-4 font-medium mb-1 text-[${DESIGN.PRIMARY_NOIR}]`}>Category Focus</div>
                        {CATEGORIES.map(c=> (
                          <Pill key={c} label={c} active={category===c} onClick={()=>setCategory(c)}/>
                        ))}
                      </div>
                    </div>
                  </Section>

                  <Section title={`Top Picks: ${category}`} right={<div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}] font-semibold`}>List View</div>}>
                    <div className="grid md:grid-cols-2 gap-4">
                      {ranked.map(p=> (
                        <ProductCardV2 key={p.id} p={p} onAddToRoutine={addToRoutine} onStartReview={handleAddToMakeupReview} />
                      ))}
                    </div>
                  </Section>
                </div>

                <aside>
                    <Section title="Editorial Insights">
                        <h4 className={`text-[20px] font-medium text-[${DESIGN.PRIMARY_NOIR}] playfair-text mb-4`}>Top 3 Trending Products Now</h4>
                        <div className="space-y-4">
                        {Object.entries(weeklyTop).slice(0,3).map(([cat, items])=> (
                            <div key={cat} className="mb-2 border-b border-gray-200 pb-2 last:border-b-0">
                                <div className={`text-[16px] font-bold mb-1 capitalize text-[${DESIGN.HIGHLIGHT_PLUM}]`}>{cat}</div>
                                <ul className="text-[16px] list-none space-y-1">
                                    {items.slice(0,3).map((e,i)=> (
                                        <li key={i} className={`flex items-center gap-2 text-[${DESIGN.MUTED_TEXT}]`}>
                                            <span className={`text-[${DESIGN.PRIMARY_NOIR}]`}>{e.product?.brand} {e.product?.name}</span> <span className="font-semibold text-[14px] ml-auto text-yellow-500">‚≠ê {e.avg}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        ))}
                        </div>
                    </Section>
                </aside>
              </div>
            )}

            {tab==="community" && (
              <div id="community" className="pt-6 grid md:grid-cols-3 gap-8">
                <div className="md:col-span-2">
                  <Section title="Post Review">
                    <div className="grid md:grid-cols-2 gap-4 text-[16px]">
                      <div className="md:col-span-2">
                        <div className={`mb-1 font-medium text-[${DESIGN.PRIMARY_NOIR}]`}>Product & Rating</div>
                        <div className="flex gap-4 items-center">
                            <select className={`flex-1 border ${DESIGN.BORDER} ${DESIGN.ROUNDING_CARD} p-2 text-[16px] bg-white text-[${DESIGN.PRIMARY_NOIR}]`} value={newReview.productId} onChange={e=>setNewReview({...newReview, productId:e.target.value})}>
                                {PRODUCTS.map(p=> <option key={p.id} value={p.id}>{p.brand} ‚Äî {p.name}</option>)}
                            </select>
                            <div className="text-lg flex items-center">
                                {[1,2,3,4,5].map(star=>(
                                    <button key={star} onClick={()=>setNewReview({...newReview, rating:star})} className={`text-3xl transition-colors hover:scale-[1.1] ${newReview.rating>=star?'text-yellow-500':'text-gray-300'}`}>‚òÖ</button>
                                ))}
                            </div>
                        </div>
                      </div>
                      
                      <div className="md:col-span-2">
                        <div className={`mb-1 font-medium flex justify-between text-[${DESIGN.PRIMARY_NOIR}]`}>
                            Mini‚ÄëReview <span className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>{newReview.text.length}/240</span>
                        </div>
                        <textarea maxLength={240} value={newReview.text} onChange={e=>setNewReview({...newReview, text:e.target.value})} className={`w-full border ${DESIGN.BORDER} ${DESIGN.ROUNDING_CARD} p-3 h-20 text-[16px] bg-white text-[${DESIGN.PRIMARY_NOIR}]`} placeholder="Keep it short..."/>
                      </div>
                      
                      <div className="flex items-center gap-4">
                        <div className={`font-medium text-[${DESIGN.PRIMARY_NOIR}]`}>Skin Type Tag:</div>
                        <select className={`border ${DESIGN.BORDER} ${DESIGN.ROUNDING_CARD} p-2 text-[16px] bg-white text-[${DESIGN.PRIMARY_NOIR}]`} value={newReview.skinType} onChange={e=>setNewReview({...newReview, skinType:e.target.value})}>
                            {['dry','oily','combination','normal','sensitive'].map(s=> <option key={s} value={s}>{s}</option>)}
                        </select>
                      </div>
                      
                      <div className="flex items-center justify-end gap-4">
                        <label className={`text-[16px] flex items-center gap-2 text-[${DESIGN.MUTED_TEXT}]`}>
                          <input type="checkbox" checked={newReview.anon} onChange={e=>setNewReview({...newReview, anon:e.target.checked})}/>
                          Post anonymously
                        </label>
                        <button type="button" onClick={submitReview} className={`px-6 h-12 bg-[${DESIGN.HIGHLIGHT_PLUM}] text-white font-bold ${DESIGN.ROUNDING_BUTTON} hover:bg-[${DESIGN.GLOW_FUCHSIA}] transition-colors`}>Post</button>
                      </div>
                    </div>
                  </Section>

                  <Section title={`GlowCircle Feed ${communityFilter.productId ? '(Filtered)' : ''}`}>
                    <div className="grid gap-4">
                      {filteredReviews.map(r=>{
                        const p = getProduct(r.productId);
                        const rComments = comments[r.id] || [];
                        
                        return (
                          <ReviewCardV2
                              key={r.id}
                              r={r}
                              p={p}
                              votes={votes}
                              rComments={rComments}
                              onToggleComment={toggleCommentOpen} 
                              submitComment={submitComment}
                              commentDrafts={commentDrafts}
                              setCommentDrafts={setCommentDrafts}
                              openCommentsState={openComments} 
                          />
                        )
                      })}
                    </div>
                  </Section>
                </div>

                <aside>
                  <Section title="Trending Categories">
                    {CATEGORIES.map(cat => (
                        <button 
                            key={cat}
                            onClick={() => handleNavigation('community', { category: cat })}
                            className={`mb-2 px-4 py-2 w-full text-left capitalize ${DESIGN.ROUNDING_CARD} bg-gray-50 hover:bg-gray-100 transition-colors text-[${DESIGN.PRIMARY_NOIR}]`}
                        >
                            {cat}
                        </button>
                    ))}
                  </Section>
                </aside>
              </div>
            )}

            {tab === "routine" && (
                <div className="pt-6">
                    <Section title="My Routine Builder" right={<div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>Customize and share your regimen.</div>}>
                        
                        {/* Routine Header Row (Unified Segments) */}
                        <div className="grid grid-cols-3 gap-4 mb-6">
                            {ROUTINE_SLOTS.map(slot => (
                                <div key={slot.key} className={`text-center py-3 ${DESIGN.ROUNDING_CARD} border ${DESIGN.BORDER} bg-gray-50`}>
                                    <div className={`text-[20px] font-medium text-[${DESIGN.HIGHLIGHT_PLUM}] playfair-text`}>
                                        {slot.icon} {slot.label}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Routine Content (Grid Layout Below Headers) */}
                        <div className="grid grid-cols-3 gap-4">
                            {ROUTINE_SLOTS.map(slot => (
                                <div key={slot.key} className="flex flex-col gap-3">
                                    {routine[slot.key].map((item, index) => {
                                        const p = getProduct(item.id);
                                        return (
                                            <div key={item.id} className={`p-4 ${DESIGN.ROUNDING_CARD} border ${DESIGN.BORDER} bg-white shadow-sm`}>
                                                <div className={`text-[16px] font-bold text-[${DESIGN.PRIMARY_NOIR}]`}>
                                                    {index + 1}. {item.name}
                                                </div>
                                                <div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>
                                                    {p?.category} | {p?.brand}
                                                </div>
                                                <button 
                                                    onClick={() => removeFromRoutine(slot.key, item.id)}
                                                    className="mt-2 text-red-500 text-[14px] hover:underline"
                                                >
                                                    Remove
                                                </button>
                                            </div>
                                        );
                                    })}
                                    {routine[slot.key].length === 0 && (
                                        <div className={`p-4 text-[14px] text-[${DESIGN.MUTED_TEXT}] italic ${DESIGN.ROUNDING_CARD} border border-dashed ${DESIGN.BORDER}`}>
                                            No items added to {slot.key.toUpperCase()}.
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        {/* Routine Insights and Actions */}
                        <div className="mt-8 pt-4 border-t border-gray-100">
                            <h4 className={`text-[20px] font-medium text-[${DESIGN.PRIMARY_NOIR}] playfair-text mb-3`}>Routine Insights & Safety</h4>
                            {routineWarnings.am.length > 0 && <div className={`text-[14px] bg-red-100 text-red-700 p-3 mb-2 ${DESIGN.ROUNDING_CARD}`}>üö® AM Warning: {routineWarnings.am.join(' ')}</div>}
                            {routineWarnings.pm.length > 0 && <div className={`text-[14px] bg-red-100 text-red-700 p-3 mb-2 ${DESIGN.ROUNDING_CARD}`}>üö® PM Warning: {routineWarnings.pm.join(' ')}</div>}
                            {routineWarnings.makeup.length > 0 && <div className={`text-[14px] bg-red-100 text-red-700 p-3 mb-2 ${DESIGN.ROUNDING_CARD}`}>üö® Makeup Warning: {routineWarnings.makeup.join(' ')}</div>}

                            <button onClick={() => setShowShareModal(true)} className={`mt-4 px-6 h-12 text-white font-bold ${DESIGN.ROUNDING_BUTTON} ${DESIGN.PRIMARY_CTA_GRADIENT} hover:opacity-90 transition-opacity`}>Share Routine</button>
                        </div>

                    </Section>
                </div>
            )}

            {tab==="creators" && (
                <div className="pt-6">
                    <FollowedCreatorsSection followedCreators={followedCreators} getProduct={getProduct} />
                    <Section title="Nykaa Creator Network" right={<div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>Trusted by the community.</div>}>
                        <div className="grid md:grid-cols-2 gap-4">
                            {DEMO_CREATORS.map(creator => (
                                <CreatorCardV2 
                                    key={creator.id} 
                                    creator={creator} 
                                    isFollowing={following.includes(creator.nykaaId)} 
                                    onToggleFollow={() => toggleFollowCreator(creator.nykaaId)}
                                />
                            ))}
                        </div>
                    </Section>
                </div>
            )}

            {tab==="guides" && (
                <div className="pt-6">
                    <Section title="Skincare & Makeup Guides" right={<div className={`text-[14px] text-[${DESIGN.MUTED_TEXT}]`}>Quick tips for smarter choices.</div>}>
                        <div className="space-y-4">
                            {GUIDES_DATA.map(guide => (
                                <GuideCard 
                                    key={guide.title}
                                    title={guide.title}
                                    icon={guide.icon}
                                    content={guide.content}
                                    guideState={guideState}
                                    setGuideState={setGuideState}
                                />
                            ))}
                        </div>
                    </Section>
                </div>
            )}
            
          </main>
        </div>
      );
    }
    
    // RENDER THE MAIN COMPONENT
    ReactDOM.render(<GlowMate />, document.getElementById('root'));
    </script>
</body>
</html>
